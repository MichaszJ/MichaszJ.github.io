<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michal Jagodzinski">

<title>Kalman Filter Demo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="kalman-filter_files/libs/clipboard/clipboard.min.js"></script>
<script src="kalman-filter_files/libs/quarto-html/quarto.js"></script>
<script src="kalman-filter_files/libs/quarto-html/popper.min.js"></script>
<script src="kalman-filter_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="kalman-filter_files/libs/quarto-html/anchor.min.js"></script>
<link href="kalman-filter_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="kalman-filter_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="kalman-filter_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="kalman-filter_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="kalman-filter_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Kalman Filter Demo</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michal Jagodzinski </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span>, <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span>, <span class="bu">Distributions</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">"/Users/michal/Code/scripts/scripts/state_estimation.jl"</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This document demonstrates the usage of the generalized regular and unscented Kalman filter algorithms implemented in Julia. The underlying code for the regular and unscented Kalman filter algoirthms can be found at <a href="https://github.com/MichaszJ/scripts/blob/main/scripts/state_estimation.jl">scripts/state_estimation.jl</a>.</p>
<section id="kalman-filter" class="level1">
<h1>Kalman Filter</h1>
<p>The ordinary Kalman filter can be used to estimate the state of linear dynamic systems. The algorithm contains two distinct steps, prediction and updating. The equations that describe the predict step are given by: <span class="math display">\[ \bar{\textbf x} = \textbf{F} \textbf x + \textbf B \textbf u \]</span></p>
<p><span class="math display">\[ \bar{\textbf P} = \textbf F \textbf P \textbf F^\intercal + \textbf Q \]</span></p>
<p>Where <span class="math inline">\(\textbf x\)</span>, <span class="math inline">\(\textbf P\)</span> are the state mean and covariance, <span class="math inline">\(\bar{\textbf x}\)</span>, <span class="math inline">\(\bar{\textbf P}\)</span> are the predicted state mean and covariance, <span class="math inline">\(\textbf F\)</span> is the state transition function, <span class="math inline">\(\textbf Q\)</span> is the process covariance, and <span class="math inline">\(\textbf B\)</span>, <span class="math inline">\(\textbf u\)</span> are the control input model/function and the control input to the system.</p>
<p>The equations that describe the update step are given by: <span class="math display">\[ \textbf y = \textbf z - \textbf H \bar{\textbf x} \]</span></p>
<p><span class="math display">\[ \textbf K = \bar{\textbf P} \textbf H^\intercal (\textbf H \bar{\textbf P} \textbf H^\intercal + \textbf R)^{-1} \]</span></p>
<p><span class="math display">\[ \textbf x = \bar{\textbf x} + \textbf K \textbf y \]</span></p>
<p><span class="math display">\[ \textbf P = (\textbf I - \textbf K \textbf H) \bar{\textbf P} \]</span></p>
<p>Where <span class="math inline">\(\textbf H\)</span> is the measurement function, <span class="math inline">\(\textbf z\)</span>, <span class="math inline">\(\textbf R\)</span> are the measurement mean and noise covariance, <span class="math inline">\(\textbf y\)</span> is the residual, and <span class="math inline">\(\textbf K\)</span> is the Kalman gain.</p>
<p>For this example, an object moving in one dimension <span class="math inline">\(x\)</span> is tracked by measuring its velocity <span class="math inline">\(\dot x\)</span>.</p>
<section id="simulation-setup" class="level2">
<h2 class="anchored" data-anchor-id="simulation-setup">Simulation Setup</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">compute_test_data</span>(z_var, process_var; count<span class="op">=</span><span class="fl">1</span>, dt<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    x, vel <span class="op">=</span> <span class="fl">0.0</span>, <span class="fl">1.0</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    z_noise <span class="op">=</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fu">sqrt</span>(z_var))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    p_noise <span class="op">=</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fu">sqrt</span>(process_var))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    xs, zs <span class="op">=</span> [], []</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>count</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> vel <span class="op">+</span> <span class="fu">rand</span>(p_noise)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        x <span class="op">+=</span> v <span class="op">*</span> dt</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(xs, x)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(zs, x <span class="op">+</span> <span class="fu">rand</span>(z_noise))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xs, zs</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">run_filter</span>(count, filter<span class="op">::</span><span class="dt">KalmanFilter</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    track, zs <span class="op">=</span> <span class="fu">compute_test_data</span>(<span class="fl">10.0</span>, <span class="fl">0.01</span>, count<span class="op">=</span>count, dt<span class="op">=</span>dt)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    xs, cov <span class="op">=</span> [], []</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> z <span class="kw">in</span> zs</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        filter.state.mean, filter.state.cov <span class="op">=</span> <span class="fu">multivariate_kalman_predict</span>(filter)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        filter.state.mean, filter.state.cov <span class="op">=</span> <span class="fu">multivariate_kalman_update</span>(filter, [z])</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(xs, filter.state.mean)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(cov, filter.state.cov)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xs, cov, zs, track</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simulation-and-results" class="level2">
<h2 class="anchored" data-anchor-id="simulation-and-results">Simulation and Results</h2>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">0.0</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> [</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fl">500.0</span> <span class="fl">0.0</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.0</span> <span class="fl">49.0</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>F <span class="op">=</span> [</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1</span> dt</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0</span> <span class="fl">1</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>Q <span class="op">=</span> <span class="fu">I</span>(<span class="fl">2</span>)<span class="op">.*</span><span class="fl">0.01</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> [<span class="fl">1</span> <span class="fl">0</span>]</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> [<span class="fl">10.0</span>]</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>test_filter <span class="op">=</span> <span class="fu">KalmanFilter</span>(<span class="fu">State</span>(x, P), F, Q, H, R)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>xs, cov, zs, track <span class="op">=</span> <span class="fu">run_filter</span>(<span class="fl">50</span>, test_filter)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    track, </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"Track"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    ribbon<span class="op">=</span>[<span class="fu">sqrt</span>(c[<span class="fl">1</span>,<span class="fl">1</span>]) for c <span class="kw">in</span> cov],</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    linestyle<span class="op">=:</span>dash, </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=:</span>bottomright, </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    xlabel<span class="op">=</span><span class="st">"Time (s)"</span>, ylabel<span class="op">=</span><span class="st">"Position (m)"</span>,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span>(<span class="fl">700</span>,<span class="fl">500</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>([x[<span class="fl">1</span>] for x <span class="kw">in</span> xs], label<span class="op">=</span><span class="st">"Filter"</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(zs, label<span class="op">=</span><span class="st">"Measurements"</span>, marker<span class="op">=:</span>cross)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="kalman-filter_files/figure-html/cell-4-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Kalman Filter Simulation Results</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plot1 <span class="op">=</span> <span class="fu">plot</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    [c[<span class="fl">1</span>,<span class="fl">1</span>] for c <span class="kw">in</span> cov], </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    minorgrid<span class="op">=</span><span class="cn">true</span>, yaxis<span class="op">=:</span>log, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Position Variance"</span>, ylabel<span class="op">=</span><span class="st">"σ²"</span>, xlabel<span class="op">=</span><span class="st">"Time (s)"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>plot2 <span class="op">=</span> <span class="fu">plot</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    [c[<span class="fl">2</span>,<span class="fl">2</span>] for c <span class="kw">in</span> cov], </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    minorgrid<span class="op">=</span><span class="cn">true</span>, yaxis<span class="op">=:</span>log, </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Velocity Variance"</span>, xlabel<span class="op">=</span><span class="st">"Time (s)"</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plot1, plot2, layout<span class="op">=</span>(<span class="fl">1</span>,<span class="fl">2</span>), size<span class="op">=</span>(<span class="fl">800</span>,<span class="fl">400</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="kalman-filter_files/figure-html/cell-5-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Kalman Filter Position and Velocity Variances</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="unscented-kalman-filter" class="level1">
<h1>Unscented Kalman Filter</h1>
<p>The unscented Kalman filter can be used to estimate the state of non-linear dynamic systems. For this type of filter, sigma points <span class="math inline">\(\chi\)</span> and their corresponding weights <span class="math inline">\(\textbf W^m\)</span>, <span class="math inline">\(\textbf W^c\)</span> are generated according to some function:</p>
<p><span class="math display">\[\chi = \text{sigma-function}(\textbf x, \textbf P) \]</span></p>
<p><span class="math display">\[\textbf W^m, \textbf W^c = \text{weight-function}(n, \text{parameters})\]</span></p>
<p>For the predict step, each sigma point is passed through the process function <span class="math inline">\(F()\)</span> to form the new prior <span class="math inline">\(\mathcal{Y}\)</span>:</p>
<p><span class="math display">\[ \mathcal{Y} = F(\chi, \Delta t) \]</span></p>
<p>The mean and covariance of the prior are computed using the unscented transform, described by the following equations:</p>
<p><span class="math display">\[ \bar{\textbf x} = \sum_{i=0}^{2n} w_i^m \mathcal Y_i \]</span></p>
<p><span class="math display">\[ \bar{\textbf P} = \sum_{i=0}^{2n} w_i^c (\mathcal Y_i - \textbf x)(\mathcal Y_i - \textbf x)^\intercal + \textbf Q \]</span></p>
<p>For the update step, the sigma points of the prior must be converted into measurement space using the measurement function <span class="math inline">\(h()\)</span>:</p>
<p><span class="math display">\[ \mathcal{Z} = h(\mathcal Y) \]</span></p>
<p>The mean and covariance of these points are computed using the unscented transform:</p>
<p><span class="math display">\[\mu_z = \sum_{i=0}^{2n} w_i^m \mathcal Z_i\]</span></p>
<p><span class="math display">\[\textbf P_z = \sum_{i=0}^{2n} w_i^c (\mathcal Z_i - \mu_z)(\mathcal Z - \mu_z)^\intercal + \textbf R\]</span></p>
<p>The Kalman gain can be computed using the following equations: <span class="math display">\[ \textbf y = \textbf z - \mu_z \]</span></p>
<p><span class="math display">\[ \textbf P_{xx} = \sum_{i=0}^{2n} w_i^c (\mathcal Y_i - \textbf x)(\mathcal Z_i - \mu_z)^\intercal \]</span></p>
<p><span class="math display">\[  \textbf K = \textbf P_{xx} \textbf P_z^{-1}  \]</span></p>
<p>The updated state mean and covariance are defined as: <span class="math display">\[ \textbf x = \bar{\textbf x} + \textbf K \textbf y \]</span></p>
<p><span class="math display">\[ \textbf P = \textbf P - \textbf K \textbf P_z \textbf K^\intercal \]</span></p>
<p>To demonstrate the unscented Kalman filter, a plane is tracked by a radar which provides a slant and elevation angle measurement. For the first simulation, the plane flies at a constant velocity.</p>
<section id="linear-simulation-setup" class="level2">
<h2 class="anchored" data-anchor-id="linear-simulation-setup">Linear Simulation Setup</h2>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">f_radar</span>(x, dt)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1</span> dt <span class="fl">0</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0</span> <span class="fl">1</span> <span class="fl">0</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0</span> <span class="fl">0</span> <span class="fl">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    ] <span class="op">*</span> x</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">h_radar</span>(x)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> x[<span class="fl">1</span>]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    dy <span class="op">=</span> x[<span class="fl">3</span>]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    slant_range <span class="op">=</span> <span class="fu">sqrt</span>(dx<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> dy<span class="op">^</span><span class="fl">2</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    elevation_angle <span class="op">=</span> <span class="fu">atan</span>(dy, dx)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [slant_range, elevation_angle]</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">3.0</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>range_std <span class="op">=</span> <span class="fl">5</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>range_dist <span class="op">=</span> <span class="fu">Normal</span>(<span class="fl">0</span>, range_std)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>elev_std <span class="op">=</span> <span class="fu">deg2rad</span>(<span class="fl">0.5</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>elev_dist <span class="op">=</span> <span class="fu">Normal</span>(<span class="fl">0</span>, elev_std)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">90.0</span>, <span class="fl">1100.0</span>]</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> [</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="fl">300</span><span class="op">^</span><span class="fl">2</span> <span class="fl">0</span> <span class="fl">0</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0</span> <span class="fl">30</span><span class="op">^</span><span class="fl">2</span> <span class="fl">0</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0</span> <span class="fl">0</span> <span class="fl">150</span><span class="op">^</span><span class="fl">2</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> [</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    range_std<span class="op">^</span><span class="fl">2</span> <span class="fl">0</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0</span> elev_std<span class="op">^</span><span class="fl">2</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>Q <span class="op">=</span> <span class="fu">zeros</span>(<span class="fl">3</span>,<span class="fl">3</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>Q[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>] <span class="op">=</span> <span class="fu">Q_discrete</span>(<span class="fl">2</span>, dt<span class="op">=</span>dt)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>Q[<span class="fl">3</span>,<span class="fl">3</span>] <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">noisy_reading</span>()</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    slant_range <span class="op">=</span> <span class="fu">sqrt</span>(pos[<span class="fl">1</span>]<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> pos[<span class="fl">2</span>]<span class="op">^</span><span class="fl">2</span>) <span class="op">+</span> <span class="fu">rand</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, range_std))</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    elevation_angle <span class="op">=</span> <span class="fu">atan</span>(pos[<span class="fl">2</span>], pos[<span class="fl">1</span>]) <span class="op">+</span> <span class="fu">rand</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, elev_std))</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [slant_range, elevation_angle]</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> pos <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">1000.0</span>]</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>vel <span class="op">=</span> [<span class="fl">100.0</span>, <span class="fl">0.0</span>]</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>vel_std <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>vel_dist <span class="op">=</span> <span class="fu">Normal</span>(<span class="fl">0</span>, vel_std)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">update_ac!</span>()</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> pos</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> vel<span class="op">*</span>dt <span class="op">+</span> <span class="fu">rand</span>(vel_dist, <span class="fl">2</span>)<span class="op">*</span>dt</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    pos <span class="op">+=</span> dx</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="linear-simulation-and-results" class="level2">
<h2 class="anchored" data-anchor-id="linear-simulation-and-results">Linear Simulation and Results</h2>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ac_filter <span class="op">=</span> <span class="fu">UnscentedKalmanFilter</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    x, P, R, Q, dt, f_radar, h_radar, merwe_scaled_points, [<span class="fl">0.1</span>, <span class="fl">2.0</span>, <span class="fl">0.0</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> <span class="fu">collect</span>(dt<span class="op">:</span>dt<span class="op">:</span><span class="fl">360</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>xs, poss <span class="op">=</span> [], []</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> time</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_ac!</span>()</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    measure <span class="op">=</span> <span class="fu">noisy_reading</span>()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    ac_filter.state.mean, ac_filter.state.cov <span class="op">=</span> <span class="fu">multivariate_kalman_predict</span>(ac_filter)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    ac_filter.state.mean, ac_filter.state.cov <span class="op">=</span> <span class="fu">multivariate_kalman_update</span>(ac_filter, measure)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(xs, ac_filter.state.mean)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(poss, <span class="fu">copy</span>(pos))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>pos_plot <span class="op">=</span> <span class="fu">plot</span>(time, [x[<span class="fl">1</span>] for x <span class="kw">in</span> xs]<span class="op">./</span><span class="fl">1000</span>, label<span class="op">=</span><span class="st">"Filter"</span>, xlabel<span class="op">=</span><span class="st">"Time (s)"</span>, ylabel<span class="op">=</span><span class="st">"x Position (km)"</span>, legend<span class="op">=:</span>bottomright)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(time, [p[<span class="fl">1</span>] for p <span class="kw">in</span> poss]<span class="op">./</span><span class="fl">1000</span>, label<span class="op">=</span><span class="st">"Aircraft Position"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>vel_plot <span class="op">=</span> <span class="fu">plot</span>(time, [x[<span class="fl">2</span>] for x <span class="kw">in</span> xs], label<span class="op">=</span><span class="st">"Filter"</span>, xlabel<span class="op">=</span><span class="st">"Time (s)"</span>, ylabel<span class="op">=</span><span class="st">"x Velocity (m/s)"</span>, legend<span class="op">=:</span>bottomright)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(time, [vel[<span class="fl">1</span>] for _ <span class="kw">in</span> <span class="fu">eachindex</span>(time)], label<span class="op">=</span><span class="st">"Aircraft Velocity"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pos_plot, vel_plot, layout<span class="op">=</span>(<span class="fl">2</span>,<span class="fl">1</span>), size<span class="op">=</span>(<span class="fl">800</span>,<span class="fl">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="kalman-filter_files/figure-html/cell-7-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">UKF Linear Simulation Results</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="non-linear-simulation-setup" class="level2">
<h2 class="anchored" data-anchor-id="non-linear-simulation-setup">Non-Linear Simulation Setup</h2>
<p>This example is the same as the previous except the plane now increases its <span class="math inline">\(y\)</span> velocity at <span class="math inline">\(t=60 \; s\)</span>.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">f_radar</span>(x, dt)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1</span> dt <span class="fl">0</span> <span class="fl">0</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0</span> <span class="fl">1</span> <span class="fl">0</span> <span class="fl">0</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0</span> <span class="fl">0</span> <span class="fl">1</span> dt</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0</span> <span class="fl">0</span> <span class="fl">0</span> <span class="fl">1</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    ] <span class="op">*</span> x</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">h_radar</span>(x)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> x[<span class="fl">1</span>]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    dy <span class="op">=</span> x[<span class="fl">3</span>]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    slant_range <span class="op">=</span> <span class="fu">sqrt</span>(dx<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> dy<span class="op">^</span><span class="fl">2</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    elevation_angle <span class="op">=</span> <span class="fu">atan</span>(dy, dx)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [slant_range, elevation_angle]</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">3.0</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>range_std <span class="op">=</span> <span class="fl">5</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>range_dist <span class="op">=</span> <span class="fu">Normal</span>(<span class="fl">0</span>, range_std)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>elev_std <span class="op">=</span> <span class="fu">deg2rad</span>(<span class="fl">0.5</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>elev_dist <span class="op">=</span> <span class="fu">Normal</span>(<span class="fl">0</span>, elev_std)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">90.0</span>, <span class="fl">1100.0</span>, <span class="fl">0.0</span>]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> [</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="fl">300</span><span class="op">^</span><span class="fl">2</span> <span class="fl">0</span> <span class="fl">0</span> <span class="fl">0</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0</span> <span class="fl">30</span><span class="op">^</span><span class="fl">2</span> <span class="fl">0</span> <span class="fl">0</span> </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0</span> <span class="fl">0</span> <span class="fl">150</span><span class="op">^</span><span class="fl">2</span> <span class="fl">0</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0</span> <span class="fl">0</span> <span class="fl">0</span> <span class="fl">3</span><span class="op">^</span><span class="fl">2</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> [</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    range_std<span class="op">^</span><span class="fl">2</span> <span class="fl">0</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0</span> elev_std<span class="op">^</span><span class="fl">2</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>Q <span class="op">=</span> <span class="fu">zeros</span>(<span class="fl">4</span>,<span class="fl">4</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>Q[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>] <span class="op">=</span> <span class="fu">Q_discrete</span>(<span class="fl">2</span>, dt<span class="op">=</span>dt, var<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>Q[<span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>] <span class="op">=</span> <span class="fu">Q_discrete</span>(<span class="fl">2</span>, dt<span class="op">=</span>dt, var<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> pos <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">1000.0</span>]</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>vel <span class="op">=</span> [<span class="fl">100.0</span>, <span class="fl">0.0</span>]</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>vel_std <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>vel_dist <span class="op">=</span> <span class="fu">Normal</span>(<span class="fl">0</span>, vel_std);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="non-linear-simulation-and-results" class="level2">
<h2 class="anchored" data-anchor-id="non-linear-simulation-and-results">Non-Linear Simulation and Results</h2>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ac_maneuver_filter <span class="op">=</span> <span class="fu">UnscentedKalmanFilter</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    x, P, R, Q, dt, f_radar, h_radar, merwe_scaled_points, [<span class="fl">0.1</span>, <span class="fl">2.0</span>, <span class="fl">0.0</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> <span class="fu">collect</span>(dt<span class="op">:</span>dt<span class="op">:</span><span class="fl">360</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>xs, poss, zs <span class="op">=</span> [], [], []</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> time</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t <span class="op">&gt;=</span> <span class="fl">60</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        vel[<span class="fl">2</span>] <span class="op">=</span> <span class="fl">5</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_ac!</span>()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    measure <span class="op">=</span> <span class="fu">noisy_reading</span>()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    ac_maneuver_filter.state.mean, ac_maneuver_filter.state.cov <span class="op">=</span> <span class="fu">multivariate_kalman_predict</span>(ac_maneuver_filter)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    ac_maneuver_filter.state.mean, ac_maneuver_filter.state.cov <span class="op">=</span> <span class="fu">multivariate_kalman_update</span>(ac_maneuver_filter, measure)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(xs, ac_maneuver_filter.state.mean)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(poss, <span class="fu">copy</span>(pos))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(zs, measure)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>posx_plot <span class="op">=</span> <span class="fu">plot</span>(time, [x[<span class="fl">1</span>] for x <span class="kw">in</span> xs]<span class="op">./</span><span class="fl">1000</span>, label<span class="op">=</span><span class="st">"Filter"</span>, xlabel<span class="op">=</span><span class="st">"Time (s)"</span>, ylabel<span class="op">=</span><span class="st">"x Position (km)"</span>, legend<span class="op">=:</span>bottomright)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(time, [p[<span class="fl">1</span>] for p <span class="kw">in</span> poss]<span class="op">./</span><span class="fl">1000</span>, label<span class="op">=</span><span class="st">"Aircraft Position"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>posy_plot <span class="op">=</span> <span class="fu">plot</span>(time, [x[<span class="fl">3</span>] for x <span class="kw">in</span> xs]<span class="op">./</span><span class="fl">1000</span>, label<span class="op">=</span><span class="st">"Filter"</span>, xlabel<span class="op">=</span><span class="st">"Time (s)"</span>, ylabel<span class="op">=</span><span class="st">"y Position (m)"</span>, legend<span class="op">=:</span>bottomright)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(time, [p[<span class="fl">2</span>] for p <span class="kw">in</span> poss]<span class="op">./</span><span class="fl">1000</span>, label<span class="op">=</span><span class="st">"Aircraft Position"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(posx_plot, posy_plot, layout<span class="op">=</span>(<span class="fl">2</span>,<span class="fl">1</span>), size<span class="op">=</span>(<span class="fl">800</span>,<span class="fl">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="kalman-filter_files/figure-html/cell-9-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">UKF Non-Linear Simulation Results</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li>[1] R. R. Labbe, <em>Kalman and Bayesian Filters in Python</em>. 2020.</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>